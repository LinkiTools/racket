language: c

os: linux
dist: trusty
sudo: true
compiler:
  - gcc
  - clang
env:
  - PATH=./racket/bin:$PATH
  - PATH=./racket/bin:$PATH RACKET_CONFIGURE_ARGS="--disable-places --disable-futures --disable-extflonum"
  - PATH=./racket/bin:$PATH RACKET_CONFIGURE_ARGS="--disable-jit"
  - PATH=./racket/bin:$PATH RACKET_CONFIGURE_ARGS="--disable-jit --disable-places --disable-futures --disable-extflonum"
  
matrix:
  include:
  - os: osx
    compiler: gcc
    env: PATH=./racket/bin:$PATH
  - os: osx
    compiler: clang
    env: PATH=./racket/bin:$PATH

before_script:
  - git config --global user.email "travis-test@racket-lang.org"
  - git config --global user.name "Travis Tester"
script:
  - make CPUS="2" PKGS="racket-test db-test unstable-flonum-lib net-test" CONFIGURE_ARGS_qq="$RACKET_CONFIGURE_ARGS"
#  - raco test -l tests/racket/test
#  - racket -l tests/racket/contract/all
#  - raco test -l tests/json/json
#  - raco test -l tests/file/main
#  - raco test -l tests/net/head
#  - raco test -l tests/net/uri-codec
#  - raco test -l tests/net/url
#  - raco test -l tests/net/url-port
#  - raco test -l tests/net/encoders
#  - raco test -l tests/openssl/basic
#  - raco test -l tests/openssl/https
#  - raco test -l tests/match/main
#  - raco test -l tests/zo-path
#  - raco test -l tests/xml/test
#  - raco test -l tests/db/all-tests
#  - raco test -c tests/stxparse
  
notifications:
  email:
    recipients:
      - pmatos@linki.tools
    on_success: change

env:
  global:
   # The next declaration is the encrypted COVERITY_SCAN_TOKEN, created
   #   via the "travis encrypt" command using the project repo's public key
   - secure: "c7B5kjcxBsL8zjMRVfEUpCAEEdIbaVC7BtcfBy52j9kmBtlK3nPUMR83tcZKBlSJIB6rVBgkaJlFx9mv0NJJlD13aqZ58dF5Ik5GzkencP3pF3vYR6zZkxG1cXamqfQLB0e9rpfHX5oFB7hy/1swGMi7rP/jmaiFq5z9vVlSIhqrNU7sJULqw/e+L+nFGs8v6jSk4Q9R0rh/FImjd9aDl4yv0sVTx9VXujQLF9Qr1lzGLfxgnNhe/u/n9VOqhQTIbT/ImmMQhvUbFI2zyEPkMhn96INR5kkdyuWm1CbfTVcxuCJ89Ff4p7Fhao24zrrrM2HOo6OP5DrKEquf10IC95d4+s91fmyiRXnehg2rO4vRx+ibTXNQibbcQCGFG/z+f/ASM9VkGCD9PVqXvnWduxR6PtQ7+78QxyoGIfKSKyO7ksbPsHtrm1kg+9C/akCEI9ssTsgSwR9jurruPAU40aluXj8Y6/h9N9b0G8/R8w+BzkVpCiuyHBPQHuHhnviUJ1EK0Z+GU7Yh0kkSAhO0KuX9W/dr00CA6iaW/8fe09W5HBz2UfmQ5Rta/Xp731ylKOxjfPp3H0z35bwtd8G05mAYXvBINBnScMyAI66I0C/sJLJ1gDIhI7SsuEqwDTNA30+D5BxF15Ybp1axFiEm60SktwaKpcW1jVFIMQTo0+U="

before_install:
  - echo -n | openssl s_client -connect https://scan.coverity.com:443 | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-

addons:
  coverity_scan:
    project:
      name: "LinkiTools/racket"
      description: "The Racket Programming Language"
    notification_email: pmatos@linki.tools
    build_command_prepend: "cd racket/src && ./configure"
    build_command: "make -j 2"
    branch_pattern: coverity_scan
